function Execute(){var e=this;e.maskwapper=$(".mask-wapper-add"),e.scollwapper=$(".scoll-wapper"),e.maskwapper_Review=$(".mask-wapper-Review")}Execute.prototype.run=function(){var e=this;e.listenshowhideEvent(),e.listenSigninEvent(),e.listenreviseEvent(),e.listenDeleteEvent(),e.listenDataPiker(),e.listenselectnow(),e.listenReviewEvent(),e.listenReviewSbumitEvent(),e.listenExportSbumitEvent(),e.listenExportNewSbumitEvent(),e.listenExportbumitEvent()},Execute.prototype.showEvent=function(){this.maskwapper.show()},Execute.prototype.showReviewEvent=function(){this.maskwapper_Review.show()},Execute.prototype.hideEvent=function(){this.maskwapper.hide(),this.maskwapper_Review.hide()},Execute.prototype.listenshowhideEvent=function(){var l=this,e=$(".add-btn"),t=$(".editor-btn"),o=$(".close-btn"),n=$(".revise-btn"),a=$(".cancle-btn");$(".Review-btn");t.click(function(){l.showEvent(),l.scollwapper.css({left:"-500px"});var e=$(this);tr=e.parent().parent();var t=tr.attr("id"),o=tr.attr("AlterID"),n=tr.attr("Hospital"),a=tr.attr("ExecutionResult"),i=tr.attr("Executor"),s=tr.attr("ExecutionTime");$("#ID-executeID").val(t),$("#ID-id").val(o),$("#ID-Hospital").val(n),$("#ID-ExecutionResult").val(a),$("#ID-Executor").val(i),$("#ID-ExecutionTime").val(s)}),e.click(function(){l.showEvent(),l.scollwapper.css({left:"0"})}),o.click(function(){l.hideEvent()}),n.click(function(){}),a.click(function(){l.hideEvent()})},Execute.prototype.listenreviseEvent=function(){var e=$(".revise-group"),a=e.find("input[name='executeID']"),i=e.find("input[name='id']"),s=e.find("input[name='Hospital']"),l=e.find("textarea[name='ExecutionResult']");e.find(".revise-btn").click(function(){var e=a.val(),t=i.val(),o=s.val(),n=l.val();xfzajax.post({url:"/execute/execute_Alter_Execute/",data:{id:e,AlterID:t,Hospital:o,ExecutionResult:n},success:function(e){200===e.code&&(window.messageBox.show("执行成功"),setTimeout("window.location.reload()","500"))}})})},Execute.prototype.listenSigninEvent=function(){var e=$(".Add-group"),n=e.find("input[name='AlterID']"),a=e.find("input[name='Hospital']"),i=e.find("textarea[name='ExecutionResult']");e.find(".submit-btn").click(function(){var e=n.val(),t=a.val(),o=i.val();xfzajax.post({url:"/execute/add_Alter_Execute/",data:{AlterID:e,Hospital:t,ExecutionResult:o},success:function(e){200===e.code&&(window.messageBox.show("添加成功"),setTimeout("window.location.reload()","300"))}})})},Execute.prototype.listenDeleteEvent=function(){$(".delete-btn").click(function(){var e=$(this).parent().parent().attr("id");console.log(executeID),xfzajax.post({url:"/execute/delete_Alter_Execute/",data:{id:e},success:function(e){200===e.code&&(window.messageBox.show("删除成功"),setTimeout("window.location.reload()","300"))}})})},Execute.prototype.listenDataPiker=function(){var e=$("#startpicker"),t=$("#endpicker"),o=new Date,n={format:"yyyy/mm/dd",language:"zh-CN",formatDate:"Y/m/d",minView:"month",validateOnBlur:!0,endDate:o.getFullYear()+"/"+(o.getMonth()+1)+"/"+o.getDate(),todayBtn:"linked",todayHighlight:!0,clearBtn:!0,autoclose:!0};e.datetimepicker(n),t.datetimepicker(n)},getchecked=function(){for(var e=document.getElementsByName("se"),t=0;t<e.length;t++)if(1==e[t].checked)return e[t]},Execute.prototype.listenReviewEvent=function(){var o=this;$(".Review-btn").click(function(){var e=getchecked();if(e){var t=e.parentElement.parentElement.getAttribute("alterid");alert(t),o.showReviewEvent()}else alert("一个没有选中")})},Execute.prototype.listenselectnow=function(){$(".box-footer"),$(".box-header");var t=$(".tr-line"),o=0;t.click(function(){if(++o%2==0)t.removeClass("colour"),t.find("input[type='checkbox']").prop("checked",!1);else{var e=$(this);e.addClass("colour").siblings("tr.colour").removeClass("colour"),ckbox=e.children().children(),t.find("input[type='checkbox']").prop("checked",!1),ckbox.prop("checked",!0)}})},Execute.prototype.listenReviewSbumitEvent=function(){var e=$(".Review-group"),t=$(".Reviewsub-btn"),a=e.find("textarea[name='ReviewContent']"),i=e.find("input[name='Reviewer']");t.click(function(){var e=$("input:radio[name='Reviewstatus']:checked").val(),t=getchecked().parentElement.parentElement.getAttribute("alterid"),o=a.val(),n=i.val();alert(t),alert(e),alert(o),alert(n),xfzajax.post({url:"/alter/Review_Alter_manager/",data:{AlterID:t,ReviewStatus:e,ReviewContent:o,Reviewer:n},success:function(e){200===e.code&&(window.messageBox.show("审核成功"),setTimeout("window.location.reload()","300"))}})})},Execute.prototype.listenExportSbumitEvent=function(){var e=$(".export-BTN"),t=$(".form-group"),o=t.find("select[name='DatabaseType']"),n=t.find("select[name='Hospital']");e.click(function(){var e=o.val(),t=n.val();alert("选择的医院是:",t),$.ajax({url:"/execute/export/",type:"POST",data:{DatabaseType:e,Hospital:t},success:function(e){if(200===e.code){var t=$('<form action="download/" method="post"></form>');$("body").append(t),t.submit(),window.messageBox.show("提交导出成功!")}else window.messageBox.show(e.message)}})})},Execute.prototype.listenExportNewSbumitEvent=function(){var e=$("#testOut"),t=$(".form-group").find("select[name='DatabaseType']");e.click(function(){var e=t.val();console.log(e),xfzajax.post({url:"/execute/exportAltData/",data:{DatabaseType:e},success:function(e){if(200===e.code){var t=$('<form action="download/" method="post">'+"<input type='hidden' id='infos' name='csrfmiddlewaretoken' value='' /></form>");$("body").append(t),console.log($.cookie("csrftoken")),$("#infos").val($.cookie("csrftoken")),t.submit(),window.messageBox.show("提交导出成功!")}else window.messageBox.show(e.message)}})})},Execute.prototype.listenExportbumitEvent=function(){$(".export-btn").click(function(){$.ajax({url:"/execute/export_alt_datas_view/",type:"GET",success:function(e){if(200===e.code){for(var t in console.log(e),e.hospital)$("#Hospitals_select").append("<option value='"+e.hospital[t].dept_id+"'>"+e.hospital[t].dept_name+"</option>");for(var t in e.database)$("#database_select").append("<option value='"+e.database[t].pk+"'>"+e.database[t].dbname+"</option>")}else console.log("请求失败，没有获取到数据！")}}),Swal.fire({title:"请选择执行医院和导出数据库",html:'<lable style ="float: left;display: inline-block;width:30%;color: grey; border:0;text-align: right;" class="form-control"><b>执行医院:</b></lable>                         <select style ="float: left;display: inline-block;width:70%" name="Hospitals" id="Hospitals_select" class="form-control">                               <option value="0">全部</option>                          </select><br/>                          <lable style ="float: left;display: inline-block;width:30%;color: grey; border:0;text-align: right;" class="form-control"><b>导出数据库:</b></lable>                          <select  style ="float: left;display: inline-block;width:70%" name="database" id="database_select" class="form-control">                               <option value="0">全部</option>                          </select>',showCancelButton:!0,cancelButtonText:"导出取消",confirmButtonText:"确认导出"}).then(function(e){if(e.dismiss!==Swal.DismissReason.cancel&&e.dismiss!==Swal.DismissReason.backdrop){var n=$("#Hospitals_select option:selected").val(),t=$("#Hospitals_select option:selected").text();console.log(n),console.log(t);var a=$("#database_select option:selected").val(),i=$("#database_select option:selected").text();console.log(a),console.log(i),$.ajax({url:"/execute/export_alt_datas_view/",headers:{"X-CSRFToken":$.cookie("csrftoken")},type:"POST",data:{database:a,hospital:n},success:function(e){if(200===e.code){for(var t in console.log("返回的数据库列表是：",e),e.data)console.log("返回的数据库：",e.data[t]);if("0"!=a)var o=$('<form action="download/?dbname='+i+"&hospitalid="+n+"&databaseid="+a+"\" method=\"post\"><input type='hidden' id='infos' name='csrfmiddlewaretoken' value='' /></form>");else{console.log("医院ID是：",n);o=$('<form action="new_file_down/?dblist='+e.data+"&hospitalid="+n+"\" method=\"post\"><input type='hidden' id='infos' name='csrfmiddlewaretoken' value='' /></form>")}$("body").append(o),console.log($.cookie("csrftoken")),$("#infos").val($.cookie("csrftoken")),o.submit(),console.log("导出请求提交成功"),window.messageBox.show("提交导出成功")}else 200!==e.code&&(console.log(e.message),swal.fire(e.message,"如无医院可选，请先维护字典！","warning"))}})}else console.log("用户取消！")})})},$(function(){(new Execute).run()});